<?php
ini_set("display_errors", 1);
error_reporting(E_ALL);

require_once("TwistOAuth.phar");

$consumerKey       = "XXXX";
$consumerSecret    = "XXXX";
$accessToken       = "XXXX";
$accessTokenSecret = "XXXX";

    $fp = fopen("blockNumber.txt", "r");    
    $block = fgets($fp);
    fclose($fp);
    
    $ce = "0x4b01721f0244e7c5b5f63c20942850e447f5a5ee";
    $title = "�df44ALIS TXNS ALERT�df44"."\n"."\n";

    $url = "https://api.etherscan.io/api?module=account&action=tokentx&contractaddress=0xea610b1153477720748dc13ed378003941d84fab&address=0x4b01721f0244e7c5b5f63c20942850e447f5a5ee&startblock=".$block."&endblock=9999999&sort=asc&apikey=FW8WZU6HIRTM991BUBMTM7P2DXRF3IFVTE";      
    
	$alis = file_get_contents($url);
	$start1 = mb_strpos($alis,'status":"')+9;
        $end1 = mb_strpos($alis,'","message"');
        $status = mb_substr($alis, $start1, $end1-$start1);
	
	if ($status == 1){
		
            $start = mb_strpos($alis,'timeStamp":"')+12;
            $end = mb_strpos($alis,'","hash"');
            $timestamp = mb_substr($alis, $start, $end-$start); 
            $date = new DateTime("@$timestamp");
            $date->setTimeZone(new DateTimeZone('Asia/Tokyo'));
            $time = "[".$date->format("m-d H:i")  ."]"."\n";
      
            $start5 = mb_strpos($alis,'value":"')+8;
            $end5 = mb_strpos($alis,'","tokenName"');
            $value = mb_substr($alis, $start5, $end5-$start5);
            $val = "value：".$value / 1000000000000000000 . "  ALIS"."\n";

            $start2 = mb_strpos($alis,'blockNumber":"')+14;
            $end2 = mb_strpos($alis,'","timeStamp"');
            $Number = mb_substr($alis, $start2, $end2-$start2);
            $blockNumber = $Number +1 ;
            $fp1 = fopen("blockNumber.txt", "w");
            fwrite($fp1, "$blockNumber");
            fclose($fp1);
		
	          $start3 = mb_strpos($alis,'from":"')+7;
            $end3 = mb_strpos($alis,'","contractAddress"');
            $from = mb_substr($alis, $start3, $end3-$start3);
            if (strcasecmp("$from", "$ce") == 0 ){
                 $from1 = "from："."CoinExchange.io"."\n";
            } else {
            $from1 = "from："."$from"."\n";
	          }
	          $start4 = mb_strpos($alis,'","to":"0')+8;
            $end4 = mb_strpos($alis,'","value"');
            $to = mb_substr($alis, $start4, $end4-$start4);
            if (strcasecmp("$to", "$ce") == 0 ){
                $to1 = "to："."CoinExchange.io"."\n"."\n";
            } else {
            $to1 = "to："."$to"."\n"."\n";
            }
	          $twitter = new TwistOAuth($consumerKey, $consumerSecret, $accessToken, $accessTokenSecret);
            $result = $twitter->post("statuses/update", ["status" => "$title"."$time"."$val"."$from1"."$to1"."＃ALIS"]);
    }	
